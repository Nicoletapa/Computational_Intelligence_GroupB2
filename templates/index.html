<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Flight Network Disruption Simulator</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
  <div id="container">
    <div id="sidebar">
      <div class="header">
        <h1><i class="fas fa-plane-departure"></i> Network Disruption</h1>
        <p>Simulate airport disruptions and analyze network resilience</p>
      </div>

      <div class="section">
        <h3><i class="fas fa-eye"></i> Layer Visibility</h3>
        <div class="toggle-switches">
          <div class="toggle-item active" id="toggle-active-airports">
            <div class="toggle-label">
              <i class="fas fa-circle" style="color: #48bb78;"></i>
              Active
            </div>
            <div class="toggle-switch">
              <div class="toggle-knob"></div>
            </div>
          </div>
          <div class="toggle-item active" id="toggle-disrupted-airports">
            <div class="toggle-label">
              <i class="fas fa-circle" style="color: #f56565;"></i>
              Disrupted
            </div>
            <div class="toggle-switch">
              <div class="toggle-knob"></div>
            </div>
          </div>
          <div class="toggle-item active" id="toggle-active-routes">
            <div class="toggle-label">
              <i class="fas fa-route" style="color: #4299e1;"></i>
              Routes (Active)
            </div>
            <div class="toggle-switch">
              <div class="toggle-knob"></div>
            </div>
          </div>
          <div class="toggle-item active" id="toggle-disrupted-routes">
            <div class="toggle-label">
              <i class="fas fa-route" style="color: #f56565;"></i>
              Routes (Down)
            </div>
            <div class="toggle-switch">
              <div class="toggle-knob"></div>
            </div>
          </div>
          <div class="toggle-item" id="toggle-countries">
            <div class="toggle-label">
              <i class="fas fa-globe-americas" style="color: #718096;"></i>
              Country Borders
            </div>
            <div class="toggle-switch">
              <div class="toggle-knob"></div>
            </div>
          </div>
        </div>
      </div>

      <div class="section">
        <h3><i class="fas fa-sliders-h"></i> Controls</h3>
        
        <div class="control-group">
          <label>Auto-disrupt top airports</label>
          <div class="input-row">
            <input id="auto_n" type="number" value="0" min="0" max="50" placeholder="0">
            <select id="centrality">
              <option value="betweenness">Betweenness</option>
              <option value="degree">Degree</option>
              <option value="closeness">Closeness</option>
            </select>
          </div>
        </div>

        <div class="button-row">
          <button id="simulate" class="btn btn-primary">
            <i class="fas fa-play"></i> Simulate
          </button>
          <button id="reset" class="btn btn-secondary">
            <i class="fas fa-redo"></i> Reset
          </button>
        </div>
      </div>

      <div class="section">
        <h3><i class="fas fa-chart-line"></i> Network Metrics</h3>
        <div class="loading" id="loading">
          <div class="spinner"></div>
          <div>Analyzing network...</div>
        </div>
        <div class="metrics-box" id="metrics">
          <div style="text-align: center; color: #718096; padding: 20px;">
            Click <strong>Simulate</strong> to analyze network impact
          </div>
        </div>
        
        <!-- NEW: Detailed Metrics Section -->
        <div id="detailed-metrics-container" style="display: none;">
          <button class="metrics-expand-btn" id="expand-metrics-btn">
            <span>Show Detailed Statistics</span>
            <i class="fas fa-chevron-down"></i>
          </button>
          
          <div class="detailed-metrics" id="detailed-metrics">
            <!-- Content will be populated dynamically -->
          </div>
        </div>
        
        <div class="community-legend" id="community-legend" style="display: none;">
          <div class="legend-title">ðŸ“Š Network Communities</div>
          <div id="legend-content"></div>
        </div>
      </div>

      <div class="section" style="flex: 1;">
        <h3><i class="fas fa-list"></i> Airports</h3>
        <div id="airport-list"></div>
      </div>
    </div>

    <div id="map"></div>
  </div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script>
    // Inject Flask data into global window object for script.js to use
    window.INITIAL_DATA = {
      airports: {{ airports_json | safe }},
      routes: {{ routes_json | safe }}
    };
  </script>
  <script src="{{ url_for('static', filename='script.js') }}"></script>
</body>
</html>